{% extends "layouts/base.html" %} {% load static %}

{% block title %}
- Perfil del empleado
{% endblock %}

{% load crispy_forms_tags %}

<!-- BLOQUE CUSTOM HEAD-->
{% block custom_head %} {% endblock custom_head %}
<!--FIN BLOQUE CUSTOM HEAD-->

<!-- BLOQUE TITULO-->
{% block page_title %}
Perfil del empleado
{%endblock page_title%}
<!-- FIN BLOQUE TITULO-->

<!-- BLOQUE CONTENIDO-->
{% block content %}
<div class="container">
  <div class="row justify-content-center">

    <!-- COLUMNA PERFIL -->
    <div class="col-lg-4">
      <div class="card">
        <div class="card-body">
          <div class="d-flex flex-column">
            <div class="row">
              <div class="col align-items-center text-center">
                <div class="card ">
                  <div class="row">
                    <div class="col align-items-center text-center perfil-align">
                      {% if object.foto %}
                      <img src="{{object.foto.url}}" alt="avatar" alt="avatar" class="" height="170" id="foto" />
                      {% else %}
                      <img src='{% static "custom/images/default-user.png" %}' alt="avatar" alt="avatar" class=""
                        height="170" id="foto" />
                      {% endif %}
                    </div>
                  </div>

                  <div class="row">
                    <div class="col align-items-center text-center">
                      <hr class="hr2" />
                      <p class="lead">
                        <b>{{object.nombres |default_if_none:' - '}} {{object.apellidos |default_if_none:' - '}}</b>
                      </p>
                      <h5 class="text-center"><b>Cuit: {{object.CUIT |default_if_none:' - '}}</b></h5>
                      <h5 class="text-center"><b>Edad: {{object.edad |default_if_none:' - '}}</b></h5>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="card-body">
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">Sede</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.sede |default_if_none:' - '}}
                      </div>
                    </div>
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">Area</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.area |default_if_none:' - '}}
                      </div>
                    </div>
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">Organismo</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.organismo |default_if_none:' - '}}
                      </div>
                    </div>
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">Nro. Expediente</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.nro_expediente |default_if_none:' - '}}
                      </div>
                    </div>
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">Email oficial</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.mail_oficial |default_if_none:' - '}}
                      </div>
                    </div>
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">Teléfono</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.telefono |default_if_none:' - '}}
                      </div>
                    </div>
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">SECACGC</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.SECACGC |default_if_none:' - '}}
                      </div>
                    </div>
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">GO/Equipo</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.GO_equipo |default_if_none:' - '}}
                      </div>
                    </div>
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">Delegación</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.delegacion |default_if_none:' - '}}
                      </div>
                    </div>
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">Función</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.funcion |default_if_none:' - '}}
                      </div>
                    </div>
                    <hr class="hr2" />
                    <div class="row">
                      <div class="col-sm-auto">
                        <h6 class="mb-0 text-left">Tareas</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {% if object.tareas.all %}
                        {{object.tareas.all |join:', '}}
                        {%else%}
                        -
                        {%endif%}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- COLUMNA CARDS -->
    <div class="col-lg-5">

      <!-- Tarjeta Personal --------->
      <div class="row">
        <div class="col">
          <div class="card collapsed-card">
            <div class="card-header btn text-reset" data-card-widget="collapse">
              <h5 class="card-title">
                <i class="fas fa-user"></i>&nbsp; Datos Personales
              </h5>
              <div class="card-tools">
                <ul class="list-unstyled mb-0 d-flex justify-content-center">
                  <li>
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-plus"></i>
                    </button>
                  </li>
                </ul>
              </div>
            </div>
            <div class="card-body">
              <div class="container">
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-auto">
                      <h6 class="mb-0 text-left">Fecha Nacimiento</h6>
                    </div>
                    <div class="col-sm-auto text-secondary text-left">
                      {{object.fecha_nacimiento |default_if_none:' - '}}
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="row">
                        <div class="col-sm-auto text-left">
                          <h6 class="mb-0">DNI</h6>
                        </div>
                        <div class="col-sm-auto text-secondary text-left">
                          {{object.DNI |default_if_none:' - '}}
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="row">
                        <div class="col-sm-auto text-left">
                          <h6 class="mb-0">Sexo</h6>
                        </div>
                        <div class="col-sm-auto text-secondary text-left">
                          {{object.sexo |default_if_none:' - '}}
                        </div>
                      </div>
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-auto text-left">
                      <h6 class="mb-0 text-left">Estado Civil</h6>
                    </div>
                    <div class="col-sm-auto text-secondary text-left">
                      {{object.estado_civil |default_if_none:' - '}}
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-auto text-left">
                      <h6 class="mb-0">Hijos</h>
                    </div>
                    <div class="col-sm-auto text-secondary text-left">
                      {% if object.hijos %}
                      {{object.hijos |default_if_none:' - '}} hijos
                      {% if object.hijos_escolar >= 1%}
                      | {{object.hijos_escolar |default_if_none:' - '}} en edad escolar
                      {% endif %}
                      {% if object.hijos_discapacidad >= 1%}
                      | {{object.hijos_discapacidad |default_if_none:' - '}} con discapacidad
                      {% endif %}
                      {% else %}
                      -
                      {% endif %}
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-auto">
                      <h6 class="mb-0 text-left">Dirección</h6>
                    </div>
                    <div class="col-sm-auto text-secondary text-left">
                      {% if object.direccion_completa %}
                      {{object.direccion_completa}}
                      {% else %}
                      -
                      {% endif %}
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-auto">
                      <h6 class="mb-0 text-left">Email particular</h6>
                    </div>
                    <div class="col-sm-auto text-secondary text-left">
                      {{object.mail_particular |default_if_none:' - '}}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- FIN Tarjeta Personal --------->

      <!-- Tarjeta Laborales -->
      <div class="row">
        <div class="col">
          <div class="card collapsed-card">
            <div class="card-header btn text-reset" data-card-widget="collapse">
              <h5 class="card-title">
                <i class="fas fa-id-card-alt"></i>&nbsp; Datos Laborales
              </h5>
              <div class="card-tools">
                <ul class="list-unstyled mb-0 d-flex justify-content-center">
                  <li>
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-plus"></i>
                    </button>
                  </li>
                </ul>
              </div>
            </div>
            <div class="card-body">
              <div class="container">
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">Tipo de Contratación</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.tipo_contratacion |default_if_none:' - '}}
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">Activo</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.activo |yesno:'Sí,No'}}
                      </div>
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">Año Ingreso</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.anio_ingreso |default_if_none:' - '}}
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">Unidad Organizativa</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.unidad_organizativa |default_if_none:' - '}}
                      </div>
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">En comisión</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.en_comision |default_if_none:' - '}}
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">Remoto?</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.remoto |default_if_none:' - '}}
                      </div>
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">Gremio</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.gremio |default_if_none:' - '}}
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">Discapacidad</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.discapacidad |default_if_none:' - '}}
                      </div>
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">Cap. Polivalente</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.capacitacion_polivalente |default_if_none:' - '}}
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">Val. Nomina 2021</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.val_nomina_2021 |default_if_none:' - '}}
                      </div>
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0">Últ. Eval. Desempeño</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.ult_eval_desemp |default_if_none:' - '}}
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="col-sm-auto text-left">
                        <h6 class="mb-0 text-left">ID de Puesto</h6>
                      </div>
                      <div class="col-sm-auto text-secondary text-left">
                        {{object.id_puesto |default_if_none:' - '}}
                      </div>
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row px-1">
                    <div class="col-12 text-left">
                      <h6 class="mb-0">Observaciones</h6>
                    </div>
                    <div class="col-12 text-secondary text-left">
                      {{object.observaciones |default_if_none:' - '}}
                    </div>
                  </div>
                </div>
                <!-- FIN DATOS -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- FIN Tarjeta Laborales --------->

      <!-- Tarjeta Profesionales -->
      <div class="row">
        <div class="col">
          <div class="card collapsed-card">
            <div class="card-header btn text-reset" data-card-widget="collapse">
              <h5 class="card-title">
                <i class="fas fa-user-graduate"></i>&nbsp; Datos Profesionales
              </h5>

              <div class="card-tools">
                <ul class="list-unstyled mb-0 d-flex justify-content-center">
                  <li>
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-plus"></i>
                    </button>
                  </li>
                </ul>
              </div>
            </div>
            <div class="card-body">
              <div class="container">
                <!-- DATOS -->
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-auto">
                      <h6 class="mb-0 text-left">Nivel educativo</h6>
                    </div>
                    <div class="col-sm-auto text-secondary text-left">
                      {{object.niv_educativo |default_if_none:' - '}}
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-auto text-left">
                      <h6 class="mb-0">Profesión / Oficio</h6>
                    </div>
                    <div class="col-sm-auto text-secondary text-left">
                      {{object.profesion_oficio |default_if_none:' - '}}
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-auto text-left">
                      <h6 class="mb-0">Año de graduación</h6>
                    </div>
                    <div class="col-sm-auto text-secondary text-left">
                      {{object.anio_graduacion |default_if_none:' - '}}
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-auto text-left">
                      <h6 class="mb-0 text-left">Establecimiento</h6>
                    </div>
                    <div class="col-sm-auto text-secondary text-left">
                      {{object.establecimiento |default_if_none:' - '}}
                    </div>
                  </div>
                  <hr class="hr2" />
                  <div class="row">
                    <div class="col-sm-auto text-left">
                      <h6 class="mb-0">Titulo</h6>
                    </div>
                    <div class="col-sm-auto text-secondary text-left">
                      {{object.titulo |default_if_none:' - '}}
                    </div>
                  </div>
                </div>
                <!-- FIN DATOS -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- FIN Tarjeta Profesionales --------->

      <!-- Tarjeta EVENTOS -->
      <div class="row">
        <div class="col">
          <div class="card collapsed-card">
            <div class="card-header btn text-reset" data-card-widget="collapse">
              <h5 class="card-title">
                <i class="fas fa-chalkboard-teacher"></i>&nbsp; Eventos
              </h5>
              <div class="card-tools">
                <ul class="list-unstyled mb-0 d-flex justify-content-center">
                  <li>
                    {% if cant_eventos %}
                    <span class="badge bg-indigo">{{ cant_eventos }}</span>
                    {% endif %}
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-plus"></i>
                    </button>
                  </li>
                </ul>
              </div>
            </div>
            <div class="card-body p-2">
              {% if cant_eventos %}
              <div class="col-12">
                <div class="info-box mb-3 bg-light">
                  <span class="col-2 badge bg-gradient-indigo p-1 m-2">Inscripto
                    <h5 class="p-1 mt-1 mb-1 font-weight-bold ">
                      {{ cant_eventos}}
                    </h5>
                  </span>
                  <span class="col-2 badge bg-gradient-fuchsia p-1 m-2">Asistió
                    <h5 class="p-1 mt-1 mb-1 font-weight-bold ">
                      {{ cant_eventos_asistio }}
                    </h5>
                  </span>
                  <div class="info-box-content">
                    <div class="progress-group">
                      <span class="progress-text">Progresión de asistencia</span>
                      <span class="float-right"><b>{{cant_eventos_asistio}}</b>/{{cant_eventos}}</span>
                      <div class="progress" style="height: 3px;">
                        <div class="progress-bar bg-gray-dark"
                          style="width:{{ porcentaje_eventos_asistio| default:0 }}%;">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-body ">
                <table class="table table-sm clickable-element" style="cursor: pointer;" title="Ver todos los eventos del empleado" data-href="{% url 'empleadoevento_list' object.id %}">
                  <thead>
                    <tr>
                      <th class="font-weight-bold h6 text-center">Inscripto</th>
                      <th class="font-weight-bold h6">Tipo</th>
                      <th class="font-weight-bold h6">Evento</th>
                      <th class="font-weight-bold h6 text-center">Asistió</th>
                      <!-- <th class="font-weight-bold h6 text-center">Aprobado</th> -->
                      <!-- <th style="width: 15%"></th> -->
                    </tr>
                  </thead>
                  <tbody>
                    {% for c in eventos_empleado %}
                    <tr class="mt-2">
                      <td class="h6 text-center"> {{ c.inscripto| date:'d/m/Y' }} </td>
                      <td class="h6"> {{ c.evento.fk_tipo }} </td>
                      <th scope="row" class="h6">{{c.evento.nombre}} </th>
                      <td class="h6 text-center"> {{c.asistio | yesno:'Sí,No,-'}} </td>
                      <!-- <td class="p-0 m-0 mt-1 pr-1 text-right">
                        <i class="fas fa-trash-alt text-secondary" role="button" data-toggle="modal"
                          data-target="#modalBorrarEvento" data-id="{{c.id}}" title="Borrar evento"></i>
                      </td> -->
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <div class="row mt-4 d-flex justify-content-between">
                  <small class="text-secondary float-left">* Mostrando últimos 5 eventos</small>
                  <small class="text-primary clickable-element  float-right" data-href="{% url 'empleadoevento_list' empleado.id%}" style="cursor: pointer;" title="Ver todos los eventos del empleado">ver más</small>
                </div>
              </div>
              {% else%}
              <div class="text-center text-muted pb-3"> Sin eventos </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      <!-- FIN Tarjeta Eventos --------->

      <!-- Tarjeta LICENCIAS ---------->
      <div class="row">
        <div class="col">
          <div class="card collapsed-card">
            <div class="card-header btn text-reset" data-card-widget="collapse">
              <h5 class="card-title">
                <i class="fas fa-scroll"></i>&nbsp; Licencias
              </h5>
              <div class="card-tools">
                <ul class="list-unstyled mb-0 d-flex justify-content-center">
                  <li>
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-plus"></i>
                    </button>
                  </li>
                </ul>
              </div>
            </div>
            <div class="card-body p-2">
              <div class="container">
                <!-- DATOS -->
                <div class="card-body p-0 m-0">
                  {% if licencias_ordinarias or licencias_especiales %}
                  <div class="info-box">
                    <table class="table table-sm table-responsive">
                      <thead>
                        <tr class="bg-light">
                          <th colspan="3" class="pl-1 ">Licencias ordinarias</th>
                          <th class="text-right px-1"><span class="badge badge-info"
                              title="Disponibles obtenidos del campo VACACIONES ANUALES del perfil del empleado">Disponibles
                              {{vacaciones_disponibles}}
                            </span>
                          </th>
                        </tr>
                        <tr class="text-secondary">
                          <th scope="col" style="width: 40%" class="pl-0 "> <small>Desde</small> </th>
                          <th scope="col" style="width: 40%" class="pl-0 "><small>Hasta</small></th>
                          <th scope="col" style="width: 20%" class="pl-0  text-center"><small>Días</small></th>
                          <th scope="col" style="width: 0%"></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for lo in licencias_ordinarias %}
                        <tr>
                          <td class="pl-0">
                            <h6>{{lo.fecha_desde |date:'d/m/y'}}</h6>
                          </td>
                          <td class="pl-0">
                            <h6>{{lo.fecha_hasta |date:'d/m/y'}}</h6>
                          </td>
                          <td class="text-center"><span class="badge badge-light badge-pill">{{lo.dias_tomados}}</span>
                          </td>
                          <td class="text-right ">
                            <h6 class="p-0 m-0"></h6>
                            <i class="fas fa-trash-alt text-secondary" role="button" data-toggle="modal"
                              data-target="#modalBorrarLicencia" data-id="{{lo.id}}" title="Borrar licencia"></i>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  <div class="info-box ">
                    <div class="table-responsive">                
                    <table class="table table-sm">
                      <thead>
                        <tr class="bg-light">
                          <th colspan="4" class="pl-1">Licencias especiales</th>
                          <th class="text-right px-1"><span class="badge badge-info">Total {{ total_especiales }}</span>
                          </th>
                        </tr>
                        <tr class="text-secondary">
                          <th scope="col" style="width: 50%" class="pl-0"><small>Motivo</small> </th>
                          <th scope="col" style="width: 20%" class="pl-0"><small>Desde</small></th>
                          <th scope="col" style="width: 20%" class="pl-0"><small>Hasta</small></th>
                          <th scope="col" style="width: 10%" class="pl-0 text-center"><small>Días</small></th>
                          <th scope="col" style="width: 0%"></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for le in licencias_especiales %}
                        <tr>
                          <td class="pl-0">
                            <h6>{{le.motivo}}</h6>
                          </td>
                          <td class="pl-0">
                            <h6>{{le.fecha_desde |date:'d/m/y'}}</h6>
                          </td>
                          <td class="pl-0">
                            <h6>{{le.fecha_hasta |date:'d/m/y'}}</h6>
                          </td>
                          <td class="text-center"><span class="badge badge-light badge-pill">{{le.dias_tomados}}</span>
                          </td>
                          <td class="text-right ">
                            <h6 class="p-0 m-0"></h6>
                            <i class="fas fa-trash-alt text-secondary" role="button" data-toggle="modal"
                              data-target="#modalBorrarLicencia" data-id="{{le.id}}" title="Borrar licencia"></i>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  </div>
                  {% else %}
                  <p class="text-secondary text-center">Sin licencias</p>
                  {% if object.vacaciones_anuales %}
                  <p><span class="badge badge-info">Licencias Ordinarias Disponibles {{ vacaciones_disponibles}}</span>
                  </p>
                  {% endif %}
                  {% endif %}
                </div>
                <!-- FIN DATOS -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- FIN Tarjeta Licencias --------->

      <!-- Tarjeta Historial TIMELINE -->
      <div class="row">
        <div class="col">
          <div class="card collapsed-card">
            <div class="card-header btn text-reset" data-card-widget="collapse">
              <h5 class="card-title">
                <i class="fas fa-history"></i>&nbsp; Historial Laboral
              </h5>
              <div class="card-tools">
                <ul class="list-unstyled mb-0 d-flex justify-content-center">
                  <li>
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-plus"></i>
                    </button>
                  </li>
                </ul>
              </div>
            </div>
            <div class="card-body">
              <div class="container">
                <!-- TIMELINE-->
                <div class="timeline">

                  <!-- Sección de perfil no activo -->
                  {% if not object.activo %}
                  <div class="time-label">
                    <span class="bg-purple">{{ object.fecha_baja|default_if_none:' ' }}</span>
                  </div>
                  <div>
                    <i class="fas fa-times-circle bg-gradient-danger"></i>
                    <div class="timeline-item">
                      <h3 class="timeline-header bg-gradient-secondary text-white">PERFIL NO ACTIVO</h3>
                    </div>
                  </div>
                  {% endif %}

                  <!-- Loop para historial de traspasos -->
                  {% for t in timeline_historial %}
                  <div class="time-label">
                    <span class="bg-purple">{{ t.fecha_desde }}</span>
                  </div>
                  <div>
                    {% if t.tipo == "PERMANENTE" or t.tipo == "TEMPORARIO" %}
                    <i class="fas fa-arrows-alt-h text-white
                      {% if t.tipo == 'PERMANENTE' %}
                      bg-gradient-green
                      {% else %}
                      bg-gradient-orange
                      {% endif %}
                      ">
                    </i>
                    <div class="timeline-item">
                      <h6 class="timeline-header text-white
                      {% if t.tipo == 'PERMANENTE' %}
                      bg-gradient-green
                      {% else %}
                      bg-gradient-orange
                      {% endif %}
                      ">
                        TRASPASO {{t.tipo }}
                      </h6>
                      <!-- TIMELINE BODY -->
                      <div class="timeline-body">

                        <!-- Información específica del traspaso -->
                        {% if t.tipo == "PERMANENTE" or t.tipo == "TEMPORARIO" %}
                        <div class="row">
                          <div class="col-sm-auto">
                            <h6 class="mb-0 text-left">Destino: </h6>
                          </div>
                          <div class="col-sm-auto text-secondary text-left">
                            {{ t.sede }}
                          </div>
                        </div>
                        {% endif %}

                        <div class="row">
                          <div class="col-sm-auto text-left">
                            <h6 class="mb-0">Motivo: </h6>
                          </div>
                          <div class="col-sm-auto text-secondary text-left">
                            {{ t.motivo }}
                          </div>
                        </div>

                        {% if t.fecha_hasta %}
                        <div class="row">
                          <div class="col-sm-auto text-left">
                            <h6 class="mb-0">Hasta: </h6>
                          </div>
                          <div class="col-sm-auto text-secondary text-left">
                            {{t.fecha_hasta |default_if_none:' - '}}
                          </div>
                        </div>
                        {% endif %}

                        <!-- FIN TIMELINE BODY -->
                      </div>
                    </div>
                    {% else %}
                    <i class="fas fa-scroll text-white  bg-gradient-blue"></i>
                    <div class="timeline-item">
                      <h6 class="timeline-header bg-gradient-blue text-white">
                        LICENCIA {{t.tipo }}
                      </h6>
                      <!-- TIMELINE BODY -->
                      <div class="timeline-body">

                        <!-- Información específica del traspaso -->
                        {% if t.tipo == "PERMANENTE" or t.tipo == "TEMPORARIO" %}
                        <div class="row">
                          <div class="col-sm-auto">
                            <h6 class="mb-0 text-left">Destino: </h6>
                          </div>
                          <div class="col-sm-auto text-secondary text-left">
                            {{ t.sede }}
                          </div>
                        </div>
                        {% endif %}

                        <div class="row">
                          <div class="col-sm-auto text-left">
                            <h6 class="mb-0">Motivo: </h6>
                          </div>
                          <div class="col-sm-auto text-secondary text-left">
                            {{ t.motivo }}
                          </div>
                        </div>

                        {% if t.fecha_hasta %}
                        <div class="row">
                          <div class="col-sm-auto text-left">
                            <h6 class="mb-0">Hasta: </h6>
                          </div>
                          <div class="col-sm-auto text-secondary text-left">
                            {{t.fecha_hasta |default_if_none:' - '}}
                          </div>
                        </div>
                        {% endif %}

                        <!-- FIN TIMELINE BODY -->
                      </div>
                    </div>
                    {% endif %}
                  </div>

                  {% endfor %}

                  <!-- item final -->
                  {% if object.anio_ingreso %}
                  <div class="time-label">
                    <span class="bg-purple">
                      {{ object.anio_ingreso}}
                    </span>
                  </div>
                  {%endif%}
                  <div>
                    <i class="fas fa-arrow-right bg-maroon"></i>
                    <div class="timeline-item">
                      <h3 class="timeline-header bg-gradient-maroon text-white">INGRESO</h3>
                      <div class="timeline-body">
                        <div class="row">
                          <div class="col-sm-auto text-left">
                            <h6 class="mb-0">SEDE: </h6>
                          </div>
                          <div class="col-sm-auto text-secondary text-left">
                            {{object.sede |default_if_none:' - '}}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Icono del reloj -->
                  <div>
                    <i class="fas fa-clock bg-gray"></i>
                  </div>

                </div>
                <!-- FIN TIMELINE -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- FIN Tarjeta Historial TIMELINE -->

    </div>

    <!-- COLUMNA ACCIONES-->
    <div class="col-lg-3">

      <div class="card">
        {% if object.activo %}
        <div class="card-header  bg-success">
          <h5 class="card-title">
            <i class="fas fa-check-circle"></i>&nbsp;Perfil Activo
          </h5>
        </div>
        <div class="row my-1">
          <a href="#" data-toggle="modal" data-target="#modalActivarDesactivar" class="px-4 py-2 text-reset"><i
              class="fas fa-thumbs-down"></i> Desactivar</a>
        </div>

        {% else %}
        <div class="card-header  bg-secondary">
          <h5 class="card-title">
            <i class="fas fa-times-circle"></i>&nbsp;Perfil NO Activo
          </h5>
        </div>
        <div class="row my-1">
          <small class="text-center text-muted px-4 py-2 ">Desactivado: {{object.fecha_baja| default:'-'}}</small>
          <a href=" #" data-toggle="modal" data-target="#modalActivarDesactivar" class="px-4 py-2 text-reset"><i
              class="fas fa-thumbs-up"></i> Activar
          </a>
        </div>
        {% endif %}
      </div>

      <div class="card">
        <div class="card-header 
            {% if object.activo  %}
            bg-primary
            {% else %}
            bg-secondary
            {% endif %}
            ">
          <h5 class="card-title">
            <i class="fas fa-check-circle mr-1"></i>Acciones
          </h5>
        </div>
        <div class="row mb-1 mt-3">
          <a href="{% url 'empleado_change' object.id %}" class="px-4 text-reset 
              {% if not object.activo  %}
              disabled
              {% endif %}
              "><i class="fas fa-edit"></i> Modificar perfil
          </a>
        </div>
        <hr>
        <div class="row mb-1">
          <a href="#" data-toggle="modal" data-target="#modalAgregarTraspaso" class="px-4  text-reset 
                {% if not object.activo  %}
                disabled
                {% endif %}
                "><i class="fas fa-history"></i> Agregar Traspaso
          </a>
        </div>
        <hr>
        <div class="row mb-1">
          <a href="#" data-toggle="modal" data-target="#modalAgregarLicencia" class="px-4  text-reset 
                {% if not object.activo  %}
                disabled
                {% endif %}
                "><i class="fas fa-scroll"></i> Agregar Licencia
          </a>
        </div>
        <hr>
        <div class="row mb-3">
          <a href="#" data-toggle="modal" data-target="#modalAgregarEvento" class="px-4  text-reset
                {% if not object.activo  %}
                disabled
                {% endif %}
                "><i class="fas fa-chalkboard-teacher"></i> Agregar Evento
          </a>
        </div>
      </div>

      <div class="card">
        <a href="{% url 'empleado_delete' object.id %}" class="text-white">
          <div class="card-header bg-gradient-danger">
            <h5 class="card-title">
              <i class="fas fa-minus-circle"></i>
              Eliminar perfil
            </h5>
          </div>
        </a>
      </div>

    </div>
  </div>
</div>


<!-- ************************************* MODALES ***************************************************** -->

<!----- MODAL AGREGAR LICENCIA ----------->
<div class="modal fade" id="modalAgregarLicencia" tabindex="-1" aria-labelledby="modalagregarlicencialabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary">
        <h5 class="modal-title">Agregar Licencia</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form action="#" method="POST" id="form-agregar-licencia">
        <div class="modal-body">
          {% csrf_token %}
          {{ form_agregar_licencia |crispy}}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary boton-agregar-licencia mr-1">Confirmar</button>
          <button type="button" class="btn btn-secondary mr-1" data-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!----- MODAL ACTIVAR/DESACTIVAR --------->
<div class="modal fade" id="modalActivarDesactivar" tabindex="-1" aria-labelledby="modalActivarDesactivar"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary">
        <h5 class="modal-title" id="exampleModalLabel">
          {% if object.activo %}
          Desactivar
          {% else %}
          Activar
          {% endif %} perfil</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-center">
        <p>Está seguro que quiere
          {% if object.activo %}
          <span class="text-danger font-weight-bold"> DESACTIVAR </span>
          {% else %}
          <span class="text-success font-weight-bold"> ACTIVAR </span>
          {% endif %} el perfil?
        </p>
      </div>
      <div class="modal-footer">
        <form action="#" method="POST" id="form-cambiar-estado">
          {% csrf_token %}
          <button type="button" class="btn btn-secondary mr-1" data-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary boton-cambiar-estado" data-id="{{object.id}}">
            {% if object.activo %}
            Desactivar
            {% else %}
            Activar
            {% endif %}
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!----- MODAL AGREGAR TRASPASO ----------->
<div class="modal fade" id="modalAgregarTraspaso" tabindex="-1" aria-labelledby="modalAgregarTraspaso"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary">
        <h5 class="modal-title" id="exampleModalLabel">Agregar Traspaso</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form action="#" method="POST" id="form-agregar-traspaso" name="form-agregar-traspaso">
        {% csrf_token %}
        <div class="modal-body">
          {{ form_agregar_traspaso |crispy}}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary boton-agregar-traspaso mr-1" data-id="{{object.id}}">Confirmar</button>
          <button type="button" class="btn btn-secondary mr-1" data-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!----- MODAL BORRAR LICENCIA ------------>
<div class="modal fade" id="modalBorrarLicencia" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header bg-gradient-danger">
        <h5 class="modal-title" id="exampleModalLabel">Atención</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-center">
        <p>Está seguro que quiere borrar la licencia?</p>
      </div>
      <div class="modal-footer">
        <form action="#" method="POST" id="form-borrar-licencia">
          {% csrf_token %}
          <input id="empleadoID" name="empleadoID" type="hidden" value="{{object.id}}">
          <input id="licenciaID" name="licenciaID" class="licencia-id" type="hidden" value="">
          <button type="button" class="btn btn-secondary mr-1" data-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger boton-borrar-licencia">Borrar</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!----- MODAL AGREGAR EVENTO ------------->
<div class="modal fade" id="modalAgregarEvento" tabindex="-1" aria-labelledby="modalagregareventolabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary">
        <h5 class="modal-title" id="exampleModalLabel">Agregar Evento</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form action="#" method="POST" id="form-agregar-evento">
        <div class="modal-body">
          {% csrf_token %}
          {{ form_agregar_evento |crispy}}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary boton-agregar-evento mr-1">Confirmar</button>
          <button type="button" class="btn btn-secondary mr-1" data-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>


{% endblock content%}

{% block customJS %}

<script type="text/javascript">

  $(document).ready(function () {

    $('.boton-cambiar-estado').click(function () {
      let id = $(this).data('id');
      $.ajax({
        url: '{% url "empleado-activar-desactivar" %}',
        type: 'POST',
        data: { 'id': id, 'csrfmiddlewaretoken': '{{ csrf_token }}' },
        success: function (response) {

          if (response.status === 'success') {
            Toast.fire({
              icon: 'success',
              title: 'La operación se realizó con éxito.'
            });
          } else {
            Toast.fire({
              icon: 'error',
              title: 'Se produjo un error al realizar la operación.'
            });
          };

          setTimeout(function () {
            location.reload();
          }, 1000); // milisegundos

        },
        error: function (xhr, status, error) {
          Toast.fire({
            icon: 'error',
            title: 'Se produjo un error al realizar la operación.'
          });
          console.error(xhr.responseText);
        }
      });

      $('#modalActivarDesactivar').modal('hide');
    });

    $('.boton-agregar-traspaso').click(function () {
      let form = $('#form-agregar-traspaso')[0];
      if (form.checkValidity()) {
        let datos = $('#form-agregar-traspaso').serialize();
        $.ajax({
          url: '{% url "empleado-traspasos" %}',
          type: 'POST',
          data: datos,
          success: function (response) {
            if (response.success) {
              Toast.fire({
                icon: 'success',
                title: 'Traspaso agregado exitosamente.'
              });
              setTimeout(function () {
                location.reload();
              }, 1000); // milisegundos
            } else {
              Toast.fire({
                icon: 'error',
                title: 'Error al agregar traspaso: ' + response.errors
              });
            }
          },
          error: function (xhr, status, error) {
            var errorMessage = "Error: ";
            if (xhr.responseJSON && xhr.responseJSON.errors) {
              var errors = xhr.responseJSON.errors;
              for (var key in errors) {
                errorMessage += errors[key].join(", ");
              }
            } else {
              errorMessage += error;
            }
            Toast.fire({
              icon: 'error',
              title: errorMessage
            });
          }
        });

      } else {
        Toast.fire({
          icon: 'error',
          title: 'Por favor, complete todos los campos obligatorios.'
        });
      }
    });

    $('.boton-agregar-licencia').click(function () {
      let form = $('#form-agregar-licencia')[0];
      if (form.checkValidity()) {
        let datos = $('#form-agregar-licencia').serialize();
        $.ajax({
          url: '{% url "empleado-agregar-licencias" %}',
          type: 'POST',
          data: datos,
          success: function (response) {
            if (response.success) {
              Toast.fire({
                icon: 'success',
                title: 'Licencia agregada exitosamente,'
              });
              setTimeout(function () {
                location.reload();
              }, 1000); // milisegundos
            } else {
              Toast.fire({
                icon: 'error',
                title: 'Error al agregar licencia: ' + response.errors
              });
            }
          },
          error: function (xhr, status, error) {
            var errorMessage = "Error: ";
            if (xhr.responseJSON && xhr.responseJSON.errors) {
              var errors = xhr.responseJSON.errors;
              for (var key in errors) {
                errorMessage += errors[key].join(", ");
              }
            } else {
              errorMessage += error;
            }
            Toast.fire({
              icon: 'error',
              title: errorMessage
            });
          }
        });
      } else {
        // Si el formulario no es válido, mostramos un mensaje de error o hacemos otra acción
        Toast.fire({
          icon: 'error',
          title: 'Por favor, complete todos los campos obligatorios.'
        });
      }
    });

    $('.boton-borrar-licencia').click(function () {
      var licenciaID = $('#licenciaID').val();
      var empleadoID = $('#empleadoID').val();  // Asegúrate de tener el campo oculto con el ID del empleado

      $.ajax({
        url: '{% url "empleado-borrar-licencias" %}',
        type: 'POST',
        data: {
          csrfmiddlewaretoken: '{{ csrf_token }}',
          licenciaID: licenciaID,
          empleadoID: empleadoID
        },
        success: function (response) {
          if (response.success) {
            Toast.fire({
              icon: 'success',
              title: 'La licencia se ha eliminado correctamente.'
            });
            setTimeout(function () {
              location.reload();
            }, 1000); // Recargar la página después de 1 segundo
          } else {
            Toast.fire({
              icon: 'error',
              title: 'Se produjo un error al eliminar la licencia.'
            });
          }
        },
        error: function (xhr, status, error) {
          Toast.fire({
            icon: 'error',
            title: 'Se produjo un error en la solicitud AJAX.'
          });
          console.error(xhr.responseText);
        }
      });
    });

    $('.boton-agregar-evento').click(function () {
      let form = $('#form-agregar-evento')[0];
      if (form.checkValidity()) {
        let datos = $('#form-agregar-evento').serialize();
        $.ajax({
          url: '{% url "empleado-agregar-evento" %}',
          type: 'POST',
          data: datos,
          success: function (response) {
            if (response.success) {
              Toast.fire({
                icon: 'success',
                title: 'Evento agregado exitosamente'
              });
              setTimeout(function () {
                location.reload();
              }, 1000); // milisegundos
            } else {
              Toast.fire({
                icon: 'error',
                title: 'Error al agregar evento: ' + response.errors
              });
            }
          },
          error: function (xhr, status, error) {
            var errorMessage = "Error al agregar evento: ";
            if (xhr.responseJSON && xhr.responseJSON.errors) {
              var errors = xhr.responseJSON.errors;
              for (var key in errors) {
                errorMessage += key + ": " + errors[key].join(", ") + "; ";
              }
            } else {
              errorMessage += error;
            }
            Toast.fire({
              icon: 'error',
              title: errorMessage
            });
          }
        });
      } else {
        // Si el formulario no es válido, mostramos un mensaje de error o hacemos otra acción
        Toast.fire({
          icon: 'error',
          title: 'Por favor, complete todos los campos obligatorios.'
        });
      }
    });

    $('#modalBorrarLicencia').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget)
      var id = button.data('id')
      var modal = $(this)
      modal.find('.licencia-id').attr("value", id)
    });

    //--------------------------------------------------------------------> MEJORAS UX/UI MOSTRAR/OCULTAR CAMPOS EN LOS MODALES

    // Muestra/oculta campo fehca hasta si el traspaso es temporario o permanente
    $('#form-agregar-traspaso #div_id_fecha_hasta').addClass('d-none');
    $("#form-agregar-traspaso #id_tipo").change(function () {
      if ($(this).val() == "TEMPORARIO") {
        $('#form-agregar-traspaso #div_id_fecha_hasta').removeClass('d-none');
        $('#form-agregar-traspaso #id_fecha_hasta').attr('required', '');
        $('#form-agregar-traspaso #id_fecha_hasta').attr('data-error', 'Completa este campo.');
      } else {
        $('#form-agregar-traspaso #div_id_fecha_hasta').addClass('d-none');
        $('#form-agregar-traspaso #id_fecha_hasta').val('');
        $('#form-agregar-traspaso #id_fecha_hasta').removeAttr('required');
        $('#form-agregar-traspaso #id_fecha_hasta').removeAttr('data-error');
      }
    });

    // Muestra/oculta campo fehca hasta si la licencia 
    $("#form-agregar-licencia #div_id_motivo").addClass('d-none')
    $("#form-agregar-licencia #id_tipo").change(function () {
      if ($(this).val() == "ESPECIAL") {
        $('#form-agregar-licencia #div_id_motivo').removeClass('d-none')
        $('#form-agregar-licencia #id_motivo').attr('required', '');
        $('#form-agregar-licencia #id_id_motivo').attr('data-error', 'Completa este campo.');
      } else if ($(this).val() == "ORDINARIA") {
        $('#form-agregar-licencia #div_id_motivo').addClass('d-none')
        $('#form-agregar-licencia #motivo').val('VACACIONES');
        $('#form-agregar-licencia #id_motivo').removeAttr('required');
        $('#form-agregar-licencia #id_motivo').removeAttr('data-error');

      } else {
        $('#form-agregar-licencia #div_id_motivo').addClass('d-none')
        $('#form-agregar-licencia #motivo').val('');
        $('#form-agregar-licencia #id_motivo').removeAttr('required');
        $('#form-agregar-licencia #id_motivo').removeAttr('data-error');
      }
    });

    $(".clickable-element").click(function() {
        window.location = $(this).data("href");
    });

  });
</script>

{% endblock customJS %}